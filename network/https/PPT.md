# 为什么 TLS 是安全的

## 为什么互联网是不安全的

互联网是一套非常复杂的系统，在互联网络中，点到点的通讯往往不是简单的设备直连，而是需要经过一条由路由、代理、网关等中间设备组成的复杂链路，这就导致无论是客户端还是服务端，都无法保证，甚至无法监控流量都经过了哪些节点，以及这些节点的安全性。

根据墨菲定理，可能出现问题的地方，往往都会出问题。针对通讯链路的不可控已经出现了许多攻击方法，包括窃听、伪造、回放等，可以统称为[中间人攻击](https://en.wikipedia.org/wiki/Man-in-the-middle_attack)。

## 什么是 TLS

实现中间人攻击有两个要素，一是在通讯双方之间设置中间节点来获取通信数据流；二是能够正确解读数据流，获取通讯信息。在现实互联网环境中要完全排除流量窃听是很困难的，但是可以加密数据流，加密后的数据即使被窃取了，也很难解读成有现实意义的信息，[TLS(Transport Layer Security)](https://en.wikipedia.org/wiki/Transport_Layer_Security) 正是被设计用于通信加密的。

在 TLS 环境下，通信双方首先经过一系列步骤协商出一个临时密钥，正式通信时，发送方使用密钥加密数据流后再放在网络上；而接收方接收到网络数据后，使用密钥解密得到传输信息。TLS 是一个安全通讯协议，往往用于补充应用层协议的安全性，常用于：

1. http + TLS = https
1. websocket + TLS = wss

## TLS 如何保证安全

1. 使用非对称加密握手，建立会话，确定双方通讯临时秘钥
   - 握手过程生成三个随机数，保证双方都是通讯目标
   - 最后一个随机数，如果服务端没有私钥是没办法解密的，防止伪造服务器
   - 网络上传输的，都是即使泄漏也没关系的信息
   - 服务器证书验证
2. 使用会话秘钥加密通讯内容

## 常见的攻击

1. 心跳漏洞
2. [协议降级攻击](https://en.wikipedia.org/wiki/Downgrade_attack)
3. [session 劫持攻击](https://en.wikipedia.org/wiki/Session_hijacking)

## 性能影响

1. 握手阶段
   - 握手信息传输会占用多个 TCP 流量 —— O RTT
   - 握手过程需要使用非对称加密 —— 会话复用
2. 传输阶段
   - 信息加解密
   - 代理完全透明 —— 内容不可见导致，无法修改 http 头部；无法缓存；无法启用大部分代理功能 —— CDN
